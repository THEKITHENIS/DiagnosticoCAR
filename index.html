<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENTINEL PRO v10.0 - Sistema Multi-Vehículo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- HEADER CON SELECTOR DE VEHÍCULO -->
    <header>
        <div class="header-content">
            <div class="header-title">
                <h1>
                    <i class="fas fa-shield-halved"></i>
                    SENTINEL PRO v10.0
                </h1>
                <p>Sistema Inteligente de Mantenimiento Predictivo Multi-Vehículo</p>
            </div>
            <div class="header-right">
                <button onclick="window.location.href='vehiculos.html'" class="btn-nav">
                    <i class="fas fa-warehouse"></i>
                    Gestionar Vehículos
                </button>
                <div class="header-vehicle-selector" id="headerVehicleSelector">
                    <i class="fas fa-car"></i>
                    <select id="quickVehicleSelector" class="vehicle-dropdown">
                        <option value="">Sin vehículo seleccionado</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container">

        <!-- SECCIÓN 0: GESTIÓN DE VEHÍCULOS -->
        <div class="card vehicle-management-card">
            <h2>
                <i class="fas fa-warehouse"></i>
                Gestión de Vehículos
            </h2>
            <p class="section-description">
                Gestiona tu flota de vehículos. Añade, edita o elimina vehículos. Selecciona el vehículo activo para monitoreo OBD-II en tiempo real.
            </p>

            <div class="vehicle-management-actions">
                <button id="addVehicleBtn" class="btn btn-primary">
                    <i class="fas fa-plus-circle"></i>
                    Añadir Nuevo Vehículo
                </button>
            </div>

            <!-- LISTA DE VEHÍCULOS -->
            <div id="vehiclesList" class="vehicles-grid">
                <div class="no-vehicles-message">
                    <i class="fas fa-car-side" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                    <h3>No hay vehículos registrados</h3>
                    <p>Añade tu primer vehículo para comenzar el monitoreo OBD-II y análisis predictivo</p>
                </div>
            </div>
        </div>

        <!-- SECCIÓN 1: CONFIGURACIÓN DEL VEHÍCULO (modificada para vehículo seleccionado) -->
        <div class="card" id="vehicleConfigCard">
            <h2>
                <i class="fas fa-cog"></i>
                Configuración del Vehículo Activo
            </h2>
            <div id="noActiveVehicleMessage" class="info-message">
                <i class="fas fa-info-circle"></i>
                Selecciona un vehículo de la sección "Gestión de Vehículos" para ver su configuración
            </div>
            <div id="activeVehicleConfig" style="display: none;">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="vehicleBrand"><i class="fas fa-car"></i> Marca</label>
                        <input type="text" id="vehicleBrand" placeholder="Ej: Seat" readonly>
                    </div>
                    <div class="form-group">
                        <label for="vehicleModel"><i class="fas fa-cogs"></i> Modelo y Motor</label>
                        <input type="text" id="vehicleModel" placeholder="Ej: León 2.0 TDI" readonly>
                    </div>
                    <div class="form-group">
                        <label for="vehicleYear"><i class="fas fa-calendar"></i> Año</label>
                        <input type="number" id="vehicleYear" placeholder="Ej: 2018" min="1996" readonly>
                    </div>
                    <div class="form-group">
                        <label for="vehicleMileage"><i class="fas fa-road"></i> Kilómetros</label>
                        <input type="number" id="vehicleMileage" placeholder="Ej: 95000" readonly>
                    </div>
                    <div class="form-group">
                        <label for="vehicleType"><i class="fas fa-droplet"></i> Combustible</label>
                        <select id="vehicleType" disabled>
                            <option value="gasolina">Gasolina</option>
                            <option value="diesel">Diésel</option>
                            <option value="hibrido">Híbrido</option>
                            <option value="electrico">Eléctrico</option>
                        </select>
                    </div>
                </div>
                <p class="info-note"><i class="fas fa-info-circle"></i> Para editar estos datos, usa el botón "Editar" en la tarjeta del vehículo</p>
            </div>
        </div>

        <!-- SECCIÓN 2: SALUD DEL VEHÍCULO -->
        <div class="card health-card-main">
            <h2>
                <i class="fas fa-heartbeat"></i>
                Salud del Vehículo en Tiempo Real
            </h2>
            <div class="health-score-container">
                <div class="health-score-circle">
                    <span id="health_score" class="health-score-value excellent">100</span>
                    <span class="health-score-label">/100</span>
                </div>
                <div class="health-details-grid">
                    <div class="health-detail-item">
                        <i class="fas fa-engine"></i>
                        <span class="detail-label">Motor</span>
                        <span id="engine_health" class="detail-value">100</span>
                    </div>
                    <div class="health-detail-item">
                        <i class="fas fa-temperature-high"></i>
                        <span class="detail-label">Térmica</span>
                        <span id="thermal_health" class="detail-value">100</span>
                    </div>
                    <div class="health-detail-item">
                        <i class="fas fa-leaf"></i>
                        <span class="detail-label">Eficiencia</span>
                        <span id="efficiency_health" class="detail-value">100</span>
                    </div>
                </div>
            </div>

            <div id="warnings_container" class="warnings-container" style="display: none;"></div>
            <div id="predictions_container" class="predictions-container" style="display: none;"></div>
        </div>

        <!-- SECCIÓN 3: DATOS EN VIVO OPTIMIZADOS -->
        <div class="card">
            <h2>
                <i class="fas fa-tachometer-alt"></i>
                Datos en Vivo del Vehículo
                <span class="optimization-badge"><i class="fas fa-bolt"></i> Optimizado</span>
            </h2>

            <div class="data-section-header">
                <h3><i class="fas fa-stopwatch"></i> Datos Críticos (cada 3 segundos)</h3>
            </div>
            <div class="grid-stats">
                <div class="metric-box">
                    <div class="metric-label">
                        <i class="fas fa-cogs"></i> RPM Motor
                    </div>
                    <span class="metric-value" id="live_rpm">---</span>
                    <span class="metric-unit">rpm</span>
                </div>
                <div class="metric-box">
                    <div class="metric-label">
                        <i class="fas fa-road"></i> Velocidad
                    </div>
                    <span class="metric-value" id="live_speed">---</span>
                    <span class="metric-unit">km/h</span>
                </div>
                <div class="metric-box">
                    <div class="metric-label">
                        <i class="fas fa-route"></i> Distancia
                    </div>
                    <span class="metric-value" id="live_distance">---</span>
                    <span class="metric-unit">km</span>
                </div>
                <div class="metric-box">
                    <div class="metric-label">
                        <i class="fas fa-gas-pump"></i> Acelerador
                    </div>
                    <span class="metric-value" id="live_throttle">---</span>
                    <span class="metric-unit">%</span>
                </div>
                <div class="metric-box">
                    <div class="metric-label">
                        <i class="fas fa-weight-hanging"></i> Carga Motor
                    </div>
                    <span class="metric-value" id="live_load">---</span>
                    <span class="metric-unit">%</span>
                </div>
                <div class="metric-box">
                    <div class="metric-label">
                        <i class="fas fa-wind"></i> Flujo Aire (MAF)
                    </div>
                    <span class="metric-value" id="live_maf">---</span>
                    <span class="metric-unit">g/s</span>
                </div>
            </div>

            <div class="data-section-header thermal-section">
                <h3><i class="fas fa-clock"></i> Datos Térmicos (cada 60 segundos)</h3>
            </div>
            <div class="grid-stats thermal-grid">
                <div class="metric-box thermal">
                    <div class="metric-label">
                        <i class="fas fa-temperature-high"></i> Temp. Refrigerante
                    </div>
                    <span class="metric-value" id="live_coolant_temp">---</span>
                    <span class="metric-unit">°C</span>
                </div>
                <div class="metric-box thermal">
                    <div class="metric-label">
                        <i class="fas fa-temperature-low"></i> Temp. Admisión
                    </div>
                    <span class="metric-value" id="live_intake_temp">---</span>
                    <span class="metric-unit">°C</span>
                </div>
            </div>

            <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                <button id="analyzeTripBtn" class="btn btn-primary">
                    <i class="fas fa-brain"></i>
                    Análisis Predictivo con IA
                </button>
                <button id="downloadReportBtn" class="btn btn-primary">
                    <i class="fas fa-file-pdf"></i>
                    Descargar Informe
                </button>
                <button id="downloadCSVBtn" class="btn btn-primary">
                    <i class="fas fa-file-csv"></i>
                    Descargar CSV
                </button>
            </div>
        </div>

        <!-- SECCIÓN 4: RESULTADOS DEL ANÁLISIS PREDICTIVO -->
        <div id="ai-placeholder" class="card" style="text-align: center; padding: 3rem;">
            <i class="fas fa-brain" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem; display: block;"></i>
            <h3 style="color: #94a3b8; margin: 0;">Inicia un viaje para ver el análisis predictivo de SENTINEL PRO</h3>
            <p style="color: #cbd5e1; margin-top: 0.5rem;">El sistema analizará automáticamente tu conducción y predecirá necesidades de mantenimiento</p>
        </div>

        <div id="ai-results" style="display: none;"></div>

        <!-- SECCIÓN 5: MÓDULOS DE INTELIGENCIA -->
        <div class="grid-2">
            <div class="card">
                <h2>
                    <i class="fas fa-search"></i>
                    Análisis de Averías
                </h2>
                <p>Descubre las averías más comunes reportadas para tu modelo específico y cómo prevenirlas.</p>
                <button id="commonFailuresBtn" class="btn btn-primary" style="margin-top: 1rem;">
                    <i class="fas fa-stethoscope"></i>
                    Analizar Averías
                </button>
                <div id="common-failures-result" style="margin-top: 1rem;"></div>
            </div>

            <div class="card">
                <h2>
                    <i class="fas fa-euro-sign"></i>
                    Tasación Inteligente
                </h2>
                <p>Obtén una valoración de mercado ajustada por el trato y mantenimiento que ha recibido tu vehículo.</p>
                <button id="valuationBtn" class="btn btn-primary" style="margin-top: 1rem;">
                    <i class="fas fa-calculator"></i>
                    Calcular Valor
                </button>
                <div id="valuation-result" style="margin-top: 1rem;"></div>
            </div>
        </div>

        <!-- SECCIÓN 6: GESTIÓN DE ARCHIVOS CSV -->
        <div class="card">
            <h2>
                <i class="fas fa-database"></i>
                Gestión de Archivos CSV
            </h2>
            <p>Sube archivos CSV de viajes previos para análisis histórico y comparativo.</p>

            <div style="margin: 1.5rem 0;">
                <input type="file" id="uploadCSVInput" accept=".csv" style="display: none;">
                <button id="uploadCSVBtn" class="btn btn-primary">
                    <i class="fas fa-file-upload"></i>
                    Subir Archivo CSV
                </button>
                <button id="backupDatabaseBtn" class="btn btn-primary">
                    <i class="fas fa-download"></i>
                    Descargar Backup de Base de Datos
                </button>
            </div>

            <div id="csvFilesList" style="margin: 1.5rem 0;">
                <p class="no-data">Cargando archivos...</p>
            </div>
        </div>

        <!-- SECCIÓN 7: MANTENIMIENTO -->
        <div class="grid-2">
            <div class="card">
                <h2>
                    <i class="fas fa-wrench"></i>
                    Registro de Mantenimiento
                </h2>
                <form id="maintenanceForm">
                    <div class="form-group">
                        <label for="maintenanceType">Tipo de Intervención</label>
                        <input type="text" id="maintenanceType" placeholder="Ej: Cambio de aceite" required>
                    </div>
                    <div class="form-group">
                        <label for="maintenanceDate">Fecha</label>
                        <input type="date" id="maintenanceDate" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-plus-circle"></i>
                        Registrar Intervención
                    </button>
                </form>
            </div>

            <div class="card">
                <h2>
                    <i class="fas fa-history"></i>
                    Historial de Mantenimiento
                </h2>
                <ul id="maintenanceLog" style="list-style: none; margin: 0; padding: 0;">
                    <li class="no-data">No hay registros de mantenimiento</li>
                </ul>
            </div>
        </div>

    </div>

    <!-- MODAL PARA AÑADIR/EDITAR VEHÍCULO -->
    <div id="vehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">
                    <i class="fas fa-car"></i>
                    <span id="modalTitleText">Añadir Nuevo Vehículo</span>
                </h2>
                <span class="modal-close">&times;</span>
            </div>
            <form id="vehicleForm">
                <input type="hidden" id="vehicleId" value="">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="modalVehicleBrand"><i class="fas fa-car"></i> Marca *</label>
                        <input type="text" id="modalVehicleBrand" placeholder="Ej: Seat" required>
                    </div>
                    <div class="form-group">
                        <label for="modalVehicleModel"><i class="fas fa-cogs"></i> Modelo y Motor *</label>
                        <input type="text" id="modalVehicleModel" placeholder="Ej: León 2.0 TDI" required>
                    </div>
                    <div class="form-group">
                        <label for="modalVehicleYear"><i class="fas fa-calendar"></i> Año *</label>
                        <input type="number" id="modalVehicleYear" placeholder="Ej: 2018" min="1996" max="2030" required>
                    </div>
                    <div class="form-group">
                        <label for="modalVehicleMileage"><i class="fas fa-road"></i> Kilómetros *</label>
                        <input type="number" id="modalVehicleMileage" placeholder="Ej: 95000" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="modalVehicleType"><i class="fas fa-gas-pump"></i> Tipo de Combustible *</label>
                        <select id="modalVehicleType" required>
                            <option value="gasolina">Gasolina</option>
                            <option value="diesel">Diésel</option>
                            <option value="hibrido">Híbrido</option>
                            <option value="electrico">Eléctrico</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="modalVehicleVIN"><i class="fas fa-barcode"></i> Número de Bastidor (VIN)</label>
                        <input type="text" id="modalVehicleVIN" placeholder="Opcional" maxlength="17">
                    </div>
                    <div class="form-group">
                        <label for="modalVehiclePlate"><i class="fas fa-id-card"></i> Matrícula</label>
                        <input type="text" id="modalVehiclePlate" placeholder="Opcional" maxlength="10" style="text-transform: uppercase;">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary modal-cancel">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Guardar Vehículo
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <p>SENTINEL PRO v10.0 Multi-Vehículo - Sistema de Mantenimiento Predictivo © 2025</p>
        <p style="font-size: 0.8rem; margin-top: 0.5rem; opacity: 0.7;">
            Base de datos SQLite | Gestión multi-vehículo | Historial completo | Análisis predictivo con IA
        </p>
    </footer>

    <script src="script.js"></script>
</body>
</html>
